<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Gestión de Clientes</title>
    <script src="js/app.js"></script>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
        }

        form {
            margin-bottom: 20px;
        }
        form input, form button {
            margin: 5px 0;
            padding: 8px;
        }

        #tablaClientes {
            width: 100%;
            border-collapse: collapse;
        }

        #tablaClientes thead, #tablaClientes tbody tr {
            display: table;
            width: 100%;
            table-layout: fixed;
        }

        #tablaClientes tbody {
            display: block;
            height: calc(100vh - 250px); 
            overflow-y: auto;
        }

        #tablaClientes thead {
            width: calc(100%); 
        }

        #tablaClientes th, #tablaClientes td {
            border: 1px solid #000;
            padding: 8px;
            text-align: left;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0; top: 0;
            width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.5);
            justify-content: center; align-items: center;
        }
        .modal-content {
            background: #fff;
            padding: 20px;
            border-radius: 6px;
            width: 300px;
        }
        .modal-content input { width: 100%; margin-bottom: 10px; }
        .close { float: right; cursor: pointer; }
    </style>
</head>
<body>
    <h1>Clientes</h1>

    <form id="formCliente">
        <input type="text" id="nombre" placeholder="Nombre" required>
        <input type="text" id="telefono" placeholder="Teléfono" required>
        <input type="text" id="email" placeholder="Correo" required>
        <button type="submit">Guardar</button>
    </form>

    <h2>Listado de Clientes</h2>
    <table border="1" id="tablaClientes">
        <thead>
            <tr><th>ID</th><th>Nombre</th><th>Teléfono</th><th>Correo</th><th>Acciones</th></tr>
        </thead>
        <tbody></tbody>
    </table>

    <div id="modalEditar" class="modal">
        <div class="modal-content">
            <span class="close" onclick="cerrarModal()">&times;</span>
            <h3>Editar Cliente</h3>
            <input type="hidden" id="edit_id">
            <input type="text" id="edit_nombre" placeholder="Nombre" required>
            <input type="text" id="edit_telefono" placeholder="Teléfono" required>
            <input type="text" id="edit_email" placeholder="Correo" required>
            <button onclick="guardarEdicion()">Actualizar</button>
        </div>
    </div>

<script>
window.onload = async () => {
    await cargarTablaClientes();

    document.querySelector("#formCliente").addEventListener("submit", async e => {
        e.preventDefault();
        await agregarCliente({
            nombre: nombre.value,
            telefono: telefono.value,
            email: email.value
        });
        document.querySelector("#formCliente").reset();
        await cargarTablaClientes();
    });
};

async function cargarTablaClientes() {
    const data = await cargarClientes();
    const tbody = document.querySelector("#tablaClientes tbody");
    tbody.innerHTML = "";

    data.forEach(c => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
            <td>${c.id}</td>
            <td>${c.nombre}</td>
            <td>${c.telefono}</td>
            <td>${c.email}</td>
            <td>
                <button onclick="abrirModal(${c.id})">Editar</button>
                <button onclick="eliminarCliente(${c.id}).then(()=>cargarTablaClientes())">Eliminar</button>
            </td>
        `;
        tbody.appendChild(tr);
    });
}

async function abrirModal(id) {
    const cliente = await apiRequest(`clientes/${id}`);
    document.querySelector("#edit_id").value = cliente.id;
    document.querySelector("#edit_nombre").value = cliente.nombre;
    document.querySelector("#edit_telefono").value = cliente.telefono;
    document.querySelector("#edit_email").value = cliente.email;
    document.querySelector("#modalEditar").style.display = "flex";
}

function cerrarModal() {
    document.querySelector("#modalEditar").style.display = "none";
}

async function guardarEdicion() {
    const id = document.querySelector("#edit_id").value;
    const cliente = {
        nombre: document.querySelector("#edit_nombre").value,
        telefono: document.querySelector("#edit_telefono").value,
        email: document.querySelector("#edit_email").value
    };
    await actualizarCliente(id, cliente);
    cerrarModal();
    await cargarTablaClientes();
}
</script>
</body>
</html>

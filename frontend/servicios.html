<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Servicios</title>
    <script src="js/app.js"></script>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
        }
        form {
            margin-bottom: 10px;
        }
        form input, form button {
            padding: 5px;
            margin: 5px 0;
        }

        #tablaServicios {
            width: 100%;
            border-collapse: collapse;
        }
        #tablaServicios th, #tablaServicios td {
            border: 1px solid #000;
            padding: 8px;
            text-align: left;
        }

        #tablaServicios tbody {
            display: block;
            height: calc(100vh - 200px);
            overflow-y: auto;
        }
        #tablaServicios thead, #tablaServicios tbody tr {
            display: table;
            width: 100%;
            table-layout: fixed;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0; top: 0;
            width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.5);
            justify-content: center; align-items: center;
        }
        .modal-content {
            background: #fff;
            padding: 20px;
            border-radius: 6px;
            width: 300px;
        }
        .modal-content input { width: 100%; margin-bottom: 10px; }
        .close { float: right; cursor: pointer; }
    </style>
</head>
<body>
<h1>Servicios</h1>

<form id="formServicio">
    <input type="text" id="nombre" placeholder="Servicio" required>
    <input type="number" id="costo" placeholder="Precio" required>
    <button type="submit">Guardar</button>
</form>

<h2>Listado</h2>
<table border="1" id="tablaServicios">
<thead>
    <tr><th>ID</th><th>Servicio</th><th>Precio</th><th>Acciones</th></tr>
</thead>
<tbody></tbody>
</table>

<!-- Modal para editar -->
<div id="modalEditar" class="modal">
    <div class="modal-content">
        <span class="close" onclick="cerrarModal()">&times;</span>
        <h3>Editar Servicio</h3>
        <input type="hidden" id="edit_id">
        <input type="text" id="edit_nombre" placeholder="Servicio" required>
        <input type="number" id="edit_costo" placeholder="Precio" required>
        <button onclick="guardarEdicion()">Actualizar</button>
    </div>
</div>

<script>
window.onload = async () => {
    await cargarTablaServicios();

    document.querySelector("#formServicio").addEventListener("submit", async e => {
        e.preventDefault();
        await agregarServicio({
            nombre: nombre.value,
            costo: parseFloat(costo.value)
        });
        document.querySelector("#formServicio").reset();
        await cargarTablaServicios();
    });
};

async function cargarTablaServicios() {
    const data = await cargarServicios();
    const tbody = document.querySelector("#tablaServicios tbody");
    tbody.innerHTML = "";

    data.forEach(s => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
            <td>${s.id}</td>
            <td>${s.nombre}</td>
            <td>$${s.costo}</td>
            <td>
                <button onclick="abrirModal(${s.id})">Editar</button>
                <button onclick="eliminarServicio(${s.id}).then(()=>cargarTablaServicios())">Eliminar</button>
            </td>
        `;
        tbody.appendChild(tr);
    });
}

// Funciones del modal
async function abrirModal(id) {
    const servicio = await apiRequest(`servicios/${id}`);
    document.querySelector("#edit_id").value = servicio.id;
    document.querySelector("#edit_nombre").value = servicio.nombre;
    document.querySelector("#edit_costo").value = servicio.costo;
    document.querySelector("#modalEditar").style.display = "flex";
}

function cerrarModal() {
    document.querySelector("#modalEditar").style.display = "none";
}

// Guardar edici√≥n
async function guardarEdicion() {
    const id = document.querySelector("#edit_id").value;
    const servicio = {
        nombre: document.querySelector("#edit_nombre").value,
        costo: parseFloat(document.querySelector("#edit_costo").value)
    };
    await actualizarServicio(id, servicio);
    cerrarModal();
    await cargarTablaServicios();
}
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Gesti√≥n de Empleados</title>
    <script src="js/app.js"></script>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
        }

        form {
            margin-bottom: 20px;
        }
        form input, form button {
            margin: 5px 0;
            padding: 8px;
        }

        #tablaEmpleados {
            width: 100%;
            border-collapse: collapse;
        }

        #tablaEmpleados thead, #tablaEmpleados tbody tr {
            display: table;
            width: 100%;
            table-layout: fixed;
        }

        #tablaEmpleados tbody {
            display: block;
            height: calc(100vh - 250px);
            overflow-y: auto;
        }

        #tablaEmpleados thead {
            width: calc(100%);
        }

        #tablaEmpleados th, #tablaEmpleados td {
            border: 1px solid #000;
            padding: 8px;
            text-align: left;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0; top: 0;
            width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.5);
            justify-content: center; align-items: center;
        }
        .modal-content {
            background: #fff;
            padding: 20px;
            border-radius: 6px;
            width: 300px;
        }
        .modal-content input { width: 100%; margin-bottom: 10px; }
        .close { float: right; cursor: pointer; }
    </style>
</head>
<body>
<h1>Empleados</h1>

<form id="formEmpleado">
    <input type="text" id="nombre" placeholder="Nombre" required>
    <input type="text" id="cargo" placeholder="Cargo" required>
    <button type="submit">Guardar</button>
</form>

<h2>Listado</h2>
<table border="1" id="tablaEmpleados">
<thead>
    <tr><th>ID</th><th>Nombre</th><th>Cargo</th><th>Acciones</th></tr>
</thead>
<tbody></tbody>
</table>

<div id="modalEditar" class="modal">
    <div class="modal-content">
        <span class="close" onclick="cerrarModal()">&times;</span>
        <h3>Editar Empleado</h3>
        <input type="hidden" id="edit_id">
        <input type="text" id="edit_nombre" placeholder="Nombre" required>
        <input type="text" id="edit_cargo" placeholder="Cargo" required>
        <button onclick="guardarEdicion()">Actualizar</button>
    </div>
</div>

<script>
window.onload = async () => {
    await cargarTablaEmpleados();

    document.querySelector("#formEmpleado").addEventListener("submit", async e => {
        e.preventDefault();
        await agregarEmpleado({
            nombre: nombre.value,
            cargo: cargo.value
        });
        document.querySelector("#formEmpleado").reset();
        await cargarTablaEmpleados();
    });
};

async function cargarTablaEmpleados() {
    const data = await cargarEmpleados();
    const tbody = document.querySelector("#tablaEmpleados tbody");
    tbody.innerHTML = "";

    data.forEach(e => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
            <td>${e.id}</td>
            <td>${e.nombre}</td>
            <td>${e.cargo}</td>
            <td>
                <button onclick="abrirModal(${e.id})">Editar</button>
                <button onclick="eliminarEmpleado(${e.id}).then(()=>cargarTablaEmpleados())">Eliminar</button>
            </td>
        `;
        tbody.appendChild(tr);
    });
}

async function abrirModal(id) {
    const empleado = await apiRequest(`empleados/${id}`);
    document.querySelector("#edit_id").value = empleado.id;
    document.querySelector("#edit_nombre").value = empleado.nombre;
    document.querySelector("#edit_cargo").value = empleado.cargo;
    document.querySelector("#modalEditar").style.display = "flex";
}

function cerrarModal() {
    document.querySelector("#modalEditar").style.display = "none";
}

async function guardarEdicion() {
    const id = document.querySelector("#edit_id").value;
    const empleado = {
        nombre: document.querySelector("#edit_nombre").value,
        cargo: document.querySelector("#edit_cargo").value
    };
    await actualizarEmpleado(id, empleado);
    cerrarModal();
    await cargarTablaEmpleados();
}
</script>
</body>
</html>
